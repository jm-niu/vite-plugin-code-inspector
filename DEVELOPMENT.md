# ğŸš€ Vite-plugin-code-inspector å¼€å‘æŒ‡å—

æ¬¢è¿å‚ä¸ `vite-plugin-code-inspector` çš„å¼€å‘ï¼è¿™ä»½æ–‡æ¡£å°†å¸®åŠ©ä½ å¿«é€Ÿäº†è§£é¡¹ç›®å¹¶å¼€å§‹è´¡çŒ®ä»£ç ã€‚

## ğŸ“¦ é¡¹ç›®æ¶æ„

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº `pnpm workspace` çš„ Monorepo æ¶æ„ï¼Œä¸»è¦åˆ†ä¸ºæ ¸å¿ƒé€»è¾‘å’Œç¤ºä¾‹æ¼”ç¤ºä¸¤éƒ¨åˆ†ï¼š

```text
vite-plugin-code-inspector/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒæ’ä»¶åŒ…
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts        # æ’ä»¶å…¥å£ï¼Œè´Ÿè´£ Vite é’©å­é›†æˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ server.ts       # æœåŠ¡ç«¯é€»è¾‘ï¼Œå¤„ç†æ‰“å¼€ç¼–è¾‘å™¨è¯·æ±‚ï¼ˆåŸºäº launch-ideï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ compiler/       # ç¼–è¯‘æ—¶é€»è¾‘ï¼Œæ³¨å…¥ data-v-inspector å±æ€§
â”‚   â”‚   â”‚   â”œâ”€â”€ overlay.js      # æµè§ˆå™¨ç«¯ UI å’Œäº¤äº’é€»è¾‘
â”‚   â”‚   â”‚   â””â”€â”€ load.js         # æµè§ˆå™¨ç«¯åŠ è½½è„šæœ¬
â”‚   â”‚   â””â”€â”€ tsup.config.ts      # æ„å»ºé…ç½®
â”‚   â””â”€â”€ playground/        # ç¤ºä¾‹é¡¹ç›®ï¼ˆç”¨äºè”è°ƒæµ‹è¯•ï¼‰
â”‚       â”œâ”€â”€ react/              # Vite 7 + React ç¤ºä¾‹
â”‚       â”œâ”€â”€ vue2/               # Vue 2 ç¤ºä¾‹
â”‚       â””â”€â”€ vue3/               # Vue 3 ç¤ºä¾‹
â””â”€â”€ package.json           # æ ¹ç›®å½•è„šæœ¬
```

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

1. **å®‰è£… pnpm**:

   ```bash
   npm install -g pnpm
   ```

2. **å®‰è£…ä¾èµ–**:
   ```bash
   pnpm install
   ```

## ğŸ’» å¼€å‘å·¥ä½œæµ

ä¸ºäº†å®æ—¶çœ‹åˆ°ä»£ç ä¿®æ”¹çš„æ•ˆæœï¼Œå»ºè®®å¼€å¯å¤šçª—å£å¼€å‘æ¨¡å¼ï¼š

### 1. å¼€å¯æ ¸å¿ƒåŒ…ç›‘å¬

åœ¨æ ¹ç›®å½•ä¸‹è¿è¡Œï¼Œè¿™ä¼šå¯åŠ¨ `tsup --watch`ï¼Œå®æ—¶ç¼–è¯‘ `packages/core` åˆ° `dist` ç›®å½•ï¼š

```bash
pnpm dev
```

### 2. è¿è¡Œç¤ºä¾‹é¡¹ç›®

åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œä½ æƒ³è¦è°ƒè¯•çš„ç¤ºä¾‹ï¼š

```bash
pnpm play:react   # æµ‹è¯• React/Vite 7 å…¼å®¹æ€§
# æˆ–
pnpm play:vue3    # æµ‹è¯• Vue 3
```

### 3. è°ƒè¯•æµç¨‹

- **ä¿®æ”¹æœåŠ¡ç«¯é€»è¾‘** (`core/src/index.ts` æˆ– `core/src/server.ts`): ä¿®æ”¹å `tsup` ä¼šè‡ªåŠ¨é‡æ„ã€‚ç”±äºç¤ºä¾‹é¡¹ç›®ï¼ˆå¦‚ Vue 3ï¼‰å¯èƒ½é…ç½®äº† `nodemon` ç›‘å¬ `dist`ï¼ŒVite ä¼šè‡ªåŠ¨é‡å¯ã€‚
- **ä¿®æ”¹å‰ç«¯ UI** (`core/src/overlay.js`): ç”±äºè¯¥æ–‡ä»¶æ˜¯ç›´æ¥ä½œä¸ºæºç å¼•ç”¨çš„ï¼Œä¿®æ”¹ååªéœ€åˆ·æ–°æµè§ˆå™¨å³å¯ç”Ÿæ•ˆã€‚

## æ ¸å¿ƒåŸç†è§£æ

### 1. ç¼–è¯‘æ—¶æ³¨å…¥ (Compile-time)

æ’ä»¶é€šè¿‡ `transform` é’©å­ï¼Œä½¿ç”¨ `@vue/compiler-dom` (Vue) æˆ– `babel` (JSX) åœ¨æ¯ä¸ª DOM å…ƒç´ ä¸Šæ³¨å…¥ `data-v-inspector` å±æ€§ï¼Œæ ¼å¼ä¸º `æ–‡ä»¶è·¯å¾„:è¡Œå·:åˆ—å·`ã€‚

### 2. æµè§ˆå™¨ç«¯äº¤äº’ (Runtime)

`overlay.js` ä¼šåœ¨é¡µé¢æ³¨å…¥ä¸€ä¸ª Web Component (`<dev-inspector>`)ã€‚

- ç”¨æˆ·æŒ‰ä¸‹å¿«æ·é”®æ—¶è¿›å…¥æ£€æŸ¥æ¨¡å¼ã€‚
- ç‚¹å‡»å…ƒç´ æ—¶ï¼Œè§£æå…¶ `data-v-inspector` å±æ€§ã€‚
- å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼š`fetch('/__open-in-editor?file=...')`ã€‚

### 3. ç¼–è¾‘å™¨æ‰“å¼€ (Server-side)

åœ¨ `server.ts` ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ `configureServer` æŒ‚è½½äº†ä¸­é—´ä»¶ï¼Œæ‹¦æˆª `/__open-in-editor` è¯·æ±‚ï¼š

- ä½¿ç”¨ `launch-ide` åŒ…è‡ªåŠ¨è¯†åˆ«å¹¶æ‰“å¼€å½“å‰è¿è¡Œçš„ç¼–è¾‘å™¨ã€‚
- åŸç”Ÿæ”¯æŒ **Antigravity (agy)**, VSCode, Cursor, WebStorm ç­‰å¤šç§ IDEã€‚

## âŒ¨ï¸ å¸¸ç”¨å¼€å‘ä»»åŠ¡

### å¦‚ä½•æ”¯æŒæ–°çš„ç¼–è¾‘å™¨ï¼Ÿ

ç”±äºæˆ‘ä»¬é›†æˆäº† `launch-ide`ï¼Œå¤§éƒ¨åˆ†ä¸»æµç¼–è¾‘å™¨å·²è‡ªåŠ¨æ”¯æŒã€‚å¦‚æœéœ€è¦é’ˆå¯¹ç‰¹å®šç¼–è¾‘å™¨åšç‰¹æ®Šå¤„ç†ï¼Œå¯ä»¥åœ¨ `packages/core/src/server.ts` çš„ `openInEditor` å‡½æ•°ä¸­æ·»åŠ é€»è¾‘ã€‚

### å¦‚ä½•æ›´æ–° UI æ ·å¼ï¼Ÿ

ç¼–è¾‘ `packages/core/src/overlay.js` ä¸­çš„ `template.innerHTML`ã€‚æ‰€æœ‰æ ·å¼éƒ½åœ¨ `:host` çš„ shadow DOM ä¸­å®šä¹‰ï¼Œä¸ä¼šæ±¡æŸ“ç”¨æˆ·é¡¹ç›®çš„æ ·å¼ã€‚

## ğŸ§ª å…¼å®¹æ€§è¦æ±‚

- **Vite ç‰ˆæœ¬**: æ”¯æŒ 2.x, 3.x, 4.x, 5.x, 6.x ä»¥åŠæœ€æ–°çš„ **7.x**ã€‚
- **Node.js**: æ¨è v18+ã€‚

## ğŸš€ æ„å»ºä¸å‘å¸ƒ

1. **å…¨é‡æ„å»º**:

   ```bash
   pnpm build
   ```

2. **å‘å¸ƒæ–°ç‰ˆæœ¬**:
   é¡¹ç›®ä½¿ç”¨ `changesets` ç®¡ç†ç‰ˆæœ¬ï¼š
   ```bash
   npx changeset        # æ·»åŠ å˜æ›´è¯´æ˜
   npx changeset version # æ›´æ–°ç‰ˆæœ¬å·
   pnpm release         # å‘å¸ƒåˆ° npm
   ```
